use crate::displayinfo::*;
use crate::clickable::*;
use web_sys::CanvasRenderingContext2d;
use crate::renderable::*;
use crate::world::*;
use crate::Closure;
use web_sys::ImageData;
use wasm_bindgen::Clamped;
use crate::JsValue;
use crate::console::*;
use std::rc::Rc;

#[derive(Copy, Clone, PartialEq, Eq, Hash, FromPrimitive, Debug)]
pub enum TileImg {
    Iceberg,
    Volcano
}
impl Default for TileImg {
    fn default() -> Self {
        TileImg::Iceberg
    }
}

impl TileImg {
    fn data(&self) -> Vec<i32> {
        match self {
            TileImg::Iceberg => return [137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,64,0,0,0,64,8,6,0,0,0,170,105,113,222,0,0,0,9,112,72,89,115,0,0,0,0,0,0,0,1,0,132,121,23,115,0,0,16,0,73,68,65,84,120,156,221,155,219,115,85,229,25,198,249,3,58,157,233,69,47,123,213,233,77,103,58,157,233,133,157,233,104,59,163,86,107,61,205,40,88,28,164,29,149,162,70,211,14,8,105,17,132,114,136,149,2,85,3,2,2,1,57,165,202,65,17,16,36,41,40,57,33,228,80,205,1,37,7,164,59,1,13,1,10,254,3,95,215,239,93,251,249,242,238,149,205,81,146,204,120,241,242,173,195,222,59,235,121,222,243,187,62,198,133,16,198,141,149,188,95,243,85,64,198,242,25,198,12,248,138,245,167,194,139,203,122,77,56,30,43,34,70,245,143,213,212,93,48,176,211,231,117,134,201,207,181,134,251,38,181,152,112,204,181,181,85,125,129,207,124,235,8,200,2,191,253,225,70,147,95,61,80,31,238,24,159,158,27,17,165,237,163,78,196,136,3,7,12,102,62,117,118,103,120,248,143,29,81,235,0,151,232,156,149,207,60,57,243,248,168,17,49,34,63,218,216,250,117,216,178,61,103,192,75,231,119,153,102,1,247,224,148,148,4,86,129,191,119,114,135,137,200,185,107,98,139,89,196,248,169,255,49,34,248,141,145,36,226,166,3,223,176,227,108,88,186,182,47,60,191,164,63,76,153,115,50,76,42,237,10,19,74,58,13,36,192,57,6,172,64,115,238,69,36,233,30,228,61,51,167,107,196,136,184,233,166,14,104,9,32,0,48,249,249,158,240,72,105,183,9,231,0,131,24,29,235,58,90,71,178,164,240,217,73,211,142,143,136,107,220,52,224,60,156,204,91,90,198,164,121,112,79,10,2,33,37,115,83,23,225,88,215,30,124,188,37,106,157,223,49,224,121,129,36,89,134,92,3,55,195,234,70,157,0,229,113,139,234,121,255,198,159,137,234,28,139,128,201,211,90,66,105,121,191,129,147,0,22,23,89,178,234,84,88,186,166,219,142,33,195,220,37,33,75,159,3,48,215,248,62,199,102,49,201,117,17,194,189,69,111,156,9,175,109,29,12,155,118,13,222,48,17,55,4,188,244,133,246,240,187,167,235,205,92,61,120,165,53,5,55,211,38,128,18,146,102,204,203,25,232,138,202,238,176,118,115,119,120,125,115,95,122,156,88,16,194,49,68,136,36,254,198,220,138,51,5,4,122,11,210,241,179,127,251,196,226,13,159,37,254,92,175,107,92,51,112,30,144,135,194,252,0,254,243,59,63,8,119,143,175,49,160,34,224,182,251,142,154,136,8,204,120,122,121,206,0,99,174,172,146,213,149,92,235,181,99,126,123,117,94,182,239,233,51,33,123,0,10,112,8,68,72,178,238,164,99,62,183,112,101,255,117,89,196,117,155,58,34,109,171,128,241,22,0,1,202,233,155,170,78,68,1,104,229,230,14,91,55,87,117,154,112,157,149,235,172,16,178,125,71,135,173,123,107,250,195,156,5,23,204,204,23,173,61,111,100,188,248,250,160,213,19,83,202,122,134,145,161,115,172,136,117,233,214,115,97,123,205,165,171,18,113,85,83,79,75,214,198,88,189,73,60,112,85,115,28,207,91,116,218,128,109,123,167,39,2,221,178,165,217,128,33,92,127,239,221,182,176,231,253,174,176,115,119,74,134,174,235,51,8,247,15,214,158,14,245,71,206,154,235,0,74,150,128,50,176,144,120,158,88,129,183,20,136,130,52,226,195,213,136,40,26,213,189,198,5,204,3,247,213,156,238,149,47,254,42,212,212,116,219,131,3,160,122,95,187,173,111,87,53,25,72,64,115,237,192,190,174,80,125,48,103,171,105,59,79,206,222,61,169,232,88,191,5,9,117,13,185,80,127,108,32,52,181,14,70,160,89,1,180,214,229,111,95,48,2,116,143,64,11,17,239,125,244,245,48,34,236,31,21,48,152,25,69,7,81,214,87,107,8,62,207,53,127,93,102,95,95,219,29,14,86,167,15,109,218,123,231,152,1,150,112,14,120,238,3,166,246,80,151,125,71,160,17,174,113,95,231,128,103,213,239,234,59,88,4,1,21,64,210,244,172,165,125,118,60,115,217,128,29,115,77,247,189,112,29,156,158,8,211,58,17,89,254,164,20,68,26,99,85,49,66,224,83,30,70,251,104,156,192,198,195,233,193,1,186,115,71,179,9,128,17,105,30,57,214,216,149,106,51,1,194,49,107,237,193,142,8,174,225,112,167,1,70,248,188,142,17,3,95,219,29,73,68,150,85,164,192,8,180,30,232,188,213,169,53,0,88,241,67,214,33,34,150,175,233,72,9,0,4,172,41,199,250,60,172,130,196,2,77,18,120,32,2,224,152,176,64,31,120,191,217,86,51,249,173,117,81,219,8,224,0,10,64,214,182,214,92,104,110,206,133,163,117,157,118,206,202,103,0,206,185,72,225,51,90,59,219,250,108,69,32,194,91,205,254,234,52,88,34,222,255,117,12,46,226,128,191,23,173,230,229,143,194,148,63,45,15,227,48,9,2,10,64,125,193,98,149,89,254,154,10,27,130,214,123,251,115,102,158,50,81,243,235,132,4,30,142,85,192,63,254,176,61,124,114,228,243,208,214,220,147,74,2,30,105,57,214,107,215,5,216,44,32,79,20,132,116,117,246,135,222,158,193,112,58,119,206,142,143,124,252,69,216,187,187,41,90,151,86,98,135,226,135,5,208,36,117,98,9,2,139,59,112,76,86,176,66,171,172,39,166,74,44,226,15,211,247,133,251,39,206,79,9,224,98,182,216,144,240,163,4,17,44,133,244,36,240,88,64,212,244,161,33,48,166,233,60,96,180,7,136,255,246,158,9,93,199,7,34,56,238,115,15,50,16,145,193,49,159,5,60,194,231,176,170,157,219,234,135,4,23,75,86,17,80,185,177,41,166,90,171,53,146,32,142,230,83,151,206,197,230,74,110,173,38,236,174,71,118,132,91,239,158,151,18,0,35,133,69,69,90,154,46,90,158,118,96,42,98,32,0,159,38,130,3,26,192,242,79,180,199,3,3,18,201,157,60,107,50,112,230,130,9,192,122,78,156,54,96,28,35,220,231,154,172,68,247,17,136,226,119,33,96,235,198,127,135,221,219,27,194,158,93,141,118,110,164,36,68,108,220,112,52,172,171,108,138,245,197,146,21,29,97,201,202,110,123,238,23,23,119,68,18,124,92,131,128,135,166,158,8,191,184,167,42,252,236,214,57,41,1,84,79,5,22,80,150,198,131,217,229,109,86,175,175,218,212,107,224,149,179,45,61,85,167,193,139,21,31,70,32,193,204,62,209,62,0,1,62,56,144,138,136,40,38,128,133,12,128,159,31,188,100,199,252,222,230,245,213,6,30,1,52,36,136,0,210,43,22,240,70,229,225,80,177,178,37,172,88,215,100,4,0,28,153,62,251,152,89,47,89,205,215,8,82,112,1,1,88,128,218,78,21,22,68,250,146,153,77,97,225,178,142,80,249,118,95,44,91,125,206,150,246,69,128,124,31,11,16,184,139,231,47,25,40,145,192,10,80,17,195,61,221,151,223,227,14,2,187,235,95,169,5,176,34,196,128,205,155,26,76,251,144,128,5,44,175,168,55,18,254,190,228,136,129,47,91,152,148,236,211,234,99,28,131,4,101,2,48,178,142,127,106,111,161,11,88,192,163,194,202,179,132,169,240,67,248,127,74,64,206,130,141,10,29,229,102,252,54,75,0,230,44,2,0,6,9,34,2,225,248,210,165,84,116,15,243,63,92,211,106,192,9,166,90,117,12,112,5,67,68,86,0,1,128,255,231,202,70,35,96,246,226,86,83,220,228,146,15,141,0,204,94,90,199,34,116,92,16,3,168,183,185,97,169,207,185,130,98,0,4,32,34,0,81,180,151,11,28,170,110,142,17,29,2,188,198,5,242,236,153,139,195,72,224,152,207,241,61,15,156,64,135,230,69,2,34,18,176,62,197,128,213,171,26,12,248,172,185,117,38,152,190,105,63,33,64,67,24,72,208,76,65,193,61,186,192,186,93,255,179,170,41,91,8,17,7,32,128,34,73,22,64,170,161,6,80,169,170,34,69,224,209,160,180,47,2,164,121,29,123,237,139,0,76,159,223,64,248,13,126,11,34,68,6,160,185,39,34,0,143,246,241,127,204,31,2,22,46,254,160,128,0,58,85,172,90,51,71,141,228,148,17,34,1,52,10,170,157,33,2,119,208,184,138,169,11,36,208,174,170,224,240,85,159,226,0,15,199,67,242,240,242,111,175,233,44,1,89,34,8,152,2,39,2,8,168,18,111,93,8,214,199,223,38,8,190,250,74,99,4,143,96,254,79,150,54,26,1,126,54,225,103,141,224,139,4,160,89,128,251,178,145,160,129,53,148,87,116,26,1,148,141,124,14,2,84,5,146,10,125,169,170,66,232,68,251,201,2,205,75,138,93,243,1,208,106,133,36,0,242,125,197,21,85,137,158,20,17,64,58,206,18,48,109,102,109,40,157,209,24,30,125,234,80,1,1,126,228,174,84,24,9,216,184,247,98,65,99,17,39,48,137,5,72,251,164,65,170,64,8,136,221,89,190,1,242,154,129,0,30,18,43,0,172,64,123,223,207,90,70,214,37,148,29,68,8,5,147,130,44,196,136,0,4,55,32,14,40,3,136,0,100,194,19,7,227,176,134,85,227,58,100,24,1,4,65,52,47,23,64,251,152,12,41,16,240,136,192,55,30,237,143,205,12,96,85,205,73,59,104,75,53,128,55,123,129,45,22,7,188,248,207,136,44,8,85,193,164,70,73,29,227,91,85,159,88,38,224,89,33,193,242,127,62,14,168,132,87,3,7,9,88,134,189,127,72,178,64,140,1,52,12,104,158,130,72,115,56,190,172,20,8,1,4,64,8,16,9,128,134,8,86,30,76,254,10,1,172,144,224,51,192,229,128,103,175,115,156,173,15,16,254,134,186,69,17,128,27,144,146,169,4,113,83,72,160,24,130,128,39,158,221,27,71,243,4,61,20,74,71,203,236,2,171,136,22,64,111,140,230,41,14,24,55,49,243,35,3,176,2,28,2,214,191,245,133,21,66,184,129,90,81,72,160,67,19,1,106,114,148,9,120,248,44,208,43,105,61,235,2,202,34,252,14,113,193,215,26,34,128,108,0,1,84,168,16,96,165,112,34,84,176,88,0,249,94,233,15,151,134,12,197,3,8,136,117,128,189,208,40,75,139,6,204,196,58,167,68,168,171,73,131,154,231,241,135,104,65,21,3,32,128,38,199,91,128,210,96,22,100,49,127,191,28,17,34,64,25,69,101,182,234,14,68,67,23,111,1,20,67,128,71,74,102,213,69,2,212,19,168,17,226,156,110,112,252,227,175,133,113,152,57,179,191,194,217,126,163,189,164,224,58,102,69,54,88,190,170,205,8,160,24,34,11,136,0,53,48,104,9,240,122,232,108,229,151,53,243,203,249,123,214,244,249,61,192,251,122,195,138,161,68,170,182,29,79,59,66,8,72,158,15,237,171,17,122,110,86,75,236,102,9,240,16,192,8,29,107,167,246,129,44,155,7,88,35,148,159,255,233,205,142,70,93,228,84,49,10,17,16,160,74,144,32,8,1,234,221,189,233,102,9,80,97,228,163,191,7,233,207,125,224,67,248,46,217,0,215,2,180,153,127,178,250,153,0,141,16,22,96,110,144,88,45,4,80,18,251,1,9,177,205,138,185,36,230,49,54,255,235,130,234,212,2,68,128,138,5,165,14,198,219,16,48,231,165,207,13,124,90,11,244,198,89,0,110,224,9,208,195,74,163,30,156,239,11,124,99,132,232,123,106,159,117,142,101,33,106,175,177,46,155,35,230,251,1,21,66,164,65,102,2,107,42,219,98,12,192,98,103,44,104,46,120,159,64,166,243,233,30,23,176,24,32,2,252,171,106,5,10,185,0,194,75,11,223,14,171,17,242,4,120,13,122,224,94,164,93,157,11,180,39,64,115,2,128,139,8,174,83,19,248,233,144,90,98,53,68,214,12,37,214,74,22,152,84,82,87,48,216,17,25,154,26,69,2,136,1,127,126,249,203,248,106,218,147,0,1,178,0,152,133,101,72,80,12,208,212,199,147,112,37,240,34,201,95,83,205,0,104,63,36,209,36,73,191,171,235,196,0,139,254,73,55,168,121,0,192,13,252,194,38,243,125,74,97,10,33,63,4,65,201,10,244,20,122,177,14,176,82,56,33,129,32,161,134,72,100,208,14,203,255,33,0,166,109,230,127,48,23,93,64,89,64,90,242,230,174,32,150,53,119,175,125,77,131,84,254,106,170,36,50,84,4,113,12,209,220,211,72,221,119,131,170,4,17,92,151,114,88,202,188,115,194,167,195,54,99,20,52,67,248,71,54,96,176,90,10,76,218,97,192,19,101,177,0,42,47,44,192,7,65,61,88,54,24,102,181,44,48,242,105,2,155,154,32,149,210,92,83,63,33,173,107,213,223,194,234,44,255,111,106,40,32,96,214,188,230,180,10,204,91,0,74,212,206,148,108,83,84,72,64,190,7,208,236,92,4,80,8,217,219,219,164,14,0,188,189,179,219,211,17,83,160,15,130,172,94,243,197,136,0,24,169,76,13,142,26,40,47,220,87,137,173,97,169,4,210,248,155,28,83,3,104,32,66,67,36,23,128,4,220,128,121,128,102,28,106,243,41,244,52,29,98,34,116,255,248,25,41,1,4,194,236,219,87,70,229,88,0,82,181,187,223,82,8,121,23,230,41,134,244,162,66,154,151,134,149,1,124,19,36,109,66,128,180,173,33,10,68,168,219,203,222,83,222,23,49,42,132,52,21,34,6,16,147,72,131,4,65,92,53,90,65,190,18,212,123,67,38,197,224,196,221,89,227,88,28,2,184,233,95,52,242,69,185,128,8,160,12,54,217,213,97,130,27,248,44,0,88,31,4,57,7,56,171,142,33,1,237,201,2,68,128,95,5,88,66,212,247,231,212,1,4,65,149,194,122,187,140,133,210,185,66,2,177,139,52,168,10,208,15,67,117,205,44,64,4,104,30,160,24,160,217,0,249,212,170,192,124,13,96,45,113,254,141,140,70,97,26,138,226,163,197,218,94,145,225,115,60,199,106,115,61,112,137,170,62,198,224,16,160,145,120,28,137,229,199,98,234,8,121,46,42,84,158,145,41,54,207,60,247,213,35,5,86,173,49,159,48,70,11,160,42,242,47,18,185,169,215,202,184,193,239,75,119,134,167,203,14,88,233,136,11,168,16,210,60,192,191,23,0,148,79,139,114,11,155,246,38,217,194,231,121,206,1,43,240,190,169,18,17,154,52,9,184,149,193,154,66,29,78,159,129,149,86,29,18,54,188,213,110,69,17,85,158,47,122,210,29,107,185,24,231,120,107,20,123,1,230,1,139,43,7,226,72,204,79,134,196,158,54,58,61,255,194,214,176,254,205,67,246,16,116,131,190,35,244,162,158,32,43,128,246,239,0,32,75,45,181,136,35,78,48,89,86,205,143,246,33,66,195,23,145,206,119,120,109,6,1,12,80,153,10,1,28,161,195,5,23,202,213,10,54,225,227,229,41,74,181,94,160,226,205,207,226,46,47,130,3,31,176,53,63,36,225,152,38,2,107,128,140,223,62,180,38,204,157,191,222,38,182,60,128,105,253,196,249,130,52,37,241,224,139,221,251,226,212,249,97,215,219,59,207,89,156,240,128,21,24,165,121,13,100,1,94,254,143,29,97,106,233,146,184,89,10,240,184,181,86,132,55,224,156,139,16,2,58,68,89,22,128,5,76,129,188,200,174,46,192,106,30,64,37,24,119,102,36,4,216,172,48,255,146,241,215,247,60,19,22,188,180,206,180,100,26,60,145,130,209,122,37,240,0,47,6,94,57,30,18,164,93,137,220,14,235,35,255,163,132,135,31,157,29,75,91,5,114,117,123,26,244,114,12,120,17,162,78,16,255,255,225,143,239,75,119,73,124,239,251,63,178,147,59,30,170,176,18,145,78,144,13,17,136,230,104,76,82,104,145,253,14,17,109,89,251,203,11,107,204,53,120,72,171,15,62,61,103,32,32,3,225,216,159,251,235,250,172,132,115,126,195,107,122,255,7,159,89,250,93,187,254,195,20,248,164,13,225,167,183,188,18,35,187,159,246,162,40,153,186,53,65,201,170,108,166,22,248,39,183,60,22,190,243,221,31,132,97,91,100,32,130,155,84,72,88,4,162,17,146,8,240,85,149,182,192,34,183,221,190,204,136,224,33,9,148,128,208,214,22,155,35,38,171,64,179,10,40,219,94,60,1,156,243,61,192,147,109,72,185,212,251,252,54,38,171,198,70,91,113,177,200,130,125,136,201,185,70,123,88,51,238,173,148,7,54,48,94,117,147,20,236,96,17,116,75,144,160,17,51,4,104,96,170,61,128,42,47,101,21,184,6,193,146,104,172,73,178,6,170,144,32,49,2,156,232,26,4,224,179,144,200,111,16,220,48,117,109,129,201,166,54,255,74,95,57,30,193,133,21,233,139,1,191,166,109,114,89,215,96,168,136,137,193,44,199,145,249,231,90,45,83,104,131,179,86,136,160,74,35,125,66,194,187,7,190,140,251,0,17,174,177,35,77,36,65,2,171,128,51,216,252,229,111,54,196,13,15,144,144,173,88,135,72,72,211,28,229,46,26,231,153,175,4,252,186,54,74,202,53,248,81,88,229,143,232,69,170,73,66,10,45,117,220,188,152,220,83,13,254,192,196,109,22,113,241,63,13,89,181,59,148,173,120,172,92,167,225,130,44,77,106,48,101,237,2,245,59,193,84,171,16,244,32,69,127,147,103,186,22,141,223,16,1,197,136,128,101,109,85,45,232,33,202,253,187,248,161,50,244,222,137,107,44,247,210,180,48,182,146,80,185,81,190,114,143,224,70,32,163,125,85,27,107,187,205,243,189,188,127,207,175,204,196,223,167,241,185,156,143,223,84,2,138,17,129,107,144,62,227,244,37,191,139,211,124,177,108,104,39,120,186,193,57,103,238,2,88,63,189,125,108,202,225,56,190,70,252,11,77,189,213,97,68,167,86,150,223,192,5,137,79,215,106,234,55,149,128,203,17,193,6,234,161,61,6,67,239,226,11,247,29,165,231,124,22,34,32,39,187,149,69,251,17,53,164,213,64,67,233,89,51,125,226,147,210,217,72,27,98,142,0,0,0,171,73,68,65,84,141,202,55,34,64,162,172,65,250,140,22,81,214,19,35,178,230,243,250,31,36,34,131,194,170,112,207,111,46,67,94,218,207,171,14,209,24,235,155,104,124,68,8,200,18,161,24,161,183,76,114,5,173,197,186,52,253,39,10,93,87,158,191,222,168,62,166,4,20,115,13,30,30,159,141,100,228,45,194,155,125,36,66,187,192,181,45,127,4,129,143,40,1,89,34,136,208,230,26,9,17,113,59,94,12,150,39,135,170,186,81,208,248,168,18,80,140,8,89,132,210,167,254,119,8,215,200,227,163,5,124,84,9,200,18,65,177,2,88,128,83,171,143,5,240,49,33,96,152,69,36,205,205,245,86,110,223,10,2,36,100,12,100,44,159,225,255,198,100,87,50,171,134,245,194,0,0,0,0,73,69,78,68,174,66,96,130].to_vec(),
            TileImg::Volcano => return [137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,64,0,0,0,64,8,6,0,0,0,170,105,113,222,0,0,0,9,112,72,89,115,0,0,0,0,0,0,0,1,0,132,121,23,115,0,0,16,0,73,68,65,84,120,156,213,155,251,147,87,117,25,199,247,15,232,250,131,211,101,172,169,113,10,53,211,154,72,93,179,166,201,20,240,82,141,22,46,109,94,74,197,221,29,141,10,112,65,205,105,66,92,16,43,43,129,149,180,155,226,6,90,150,10,46,120,169,73,132,5,236,166,178,160,228,84,3,121,161,95,74,153,233,199,79,231,245,124,191,175,211,195,97,29,68,192,173,31,158,57,103,207,237,123,222,239,231,253,92,62,159,207,217,142,82,74,199,120,217,166,13,235,202,230,117,107,203,120,190,195,184,252,232,19,191,123,180,60,250,208,125,229,190,187,150,135,61,56,124,95,217,54,250,196,184,16,241,154,123,28,176,119,14,221,94,22,13,204,43,55,221,112,109,216,45,131,223,47,183,221,122,211,184,16,241,154,1,7,52,64,49,64,75,0,127,47,187,105,81,125,142,235,80,199,107,69,196,33,7,14,40,192,94,213,63,51,44,123,30,224,43,111,91,22,199,48,255,134,4,12,69,240,140,255,59,2,72,108,202,28,208,51,47,187,56,140,191,149,59,198,62,128,175,159,119,85,152,138,200,170,48,52,14,21,17,7,221,227,0,7,76,119,215,103,195,46,239,187,164,246,60,231,244,240,218,123,239,12,35,9,122,220,240,192,230,95,61,43,158,35,105,156,135,8,18,232,255,28,1,57,177,1,24,224,89,242,130,230,58,129,103,2,56,78,220,155,39,0,14,1,134,133,97,228,62,247,29,44,69,28,20,143,135,212,103,246,5,240,51,39,127,50,228,158,147,154,18,182,238,3,96,221,240,202,178,122,104,48,12,240,146,136,228,245,190,247,115,140,223,104,170,2,242,14,148,136,3,7,94,121,89,185,107,188,168,192,5,79,86,223,246,248,166,178,249,183,119,149,77,171,151,150,53,183,47,40,107,151,207,142,125,200,144,24,192,2,18,111,155,12,57,102,229,48,95,168,144,3,77,150,251,45,117,229,168,212,155,177,142,233,185,252,114,16,0,200,95,223,179,56,128,111,184,173,183,172,31,154,27,4,108,223,208,34,64,18,204,9,134,135,185,1,224,40,77,18,154,165,148,251,246,151,136,87,12,60,123,123,218,57,103,149,115,206,154,18,114,23,188,165,204,23,218,139,128,202,251,120,26,240,127,186,251,220,176,45,143,204,42,79,109,24,44,91,70,134,3,188,97,98,195,164,25,2,122,158,237,117,253,125,117,40,240,94,205,100,203,125,7,76,128,192,245,54,128,53,61,223,123,241,121,181,215,121,81,19,149,4,68,83,83,129,7,212,31,126,51,88,54,222,115,101,77,192,232,170,222,154,0,73,50,84,50,25,40,129,231,218,59,24,14,168,68,114,80,198,197,231,119,133,145,131,204,33,251,34,98,159,192,1,219,121,194,196,61,76,2,114,109,55,131,75,128,222,131,0,0,110,125,124,109,72,125,235,240,64,0,151,0,72,193,251,25,60,165,174,206,27,149,229,22,218,112,0,60,138,226,249,236,163,140,175,157,127,78,233,191,180,43,140,119,51,92,44,161,251,36,32,3,71,230,99,1,199,62,241,209,206,186,212,229,198,37,119,116,60,203,184,134,0,192,227,237,231,70,110,46,47,172,154,17,242,199,200,1,65,64,27,44,182,71,242,76,196,112,108,249,210,133,97,0,135,168,231,126,191,161,252,250,135,131,229,23,87,95,82,22,118,77,42,223,235,59,55,182,215,124,250,148,210,223,125,90,144,113,205,215,186,227,93,109,170,246,34,128,31,202,30,31,203,235,216,251,142,122,111,189,79,14,224,161,122,197,251,205,7,36,51,94,144,23,215,251,16,128,61,253,232,55,195,251,235,239,29,216,195,251,255,218,181,35,238,177,111,200,97,192,113,158,9,120,42,8,164,2,254,47,15,175,46,247,223,112,69,185,119,218,39,107,27,154,50,177,44,62,227,248,178,236,156,206,138,140,147,203,149,23,181,136,64,17,40,37,135,70,135,229,204,24,207,64,217,106,99,133,0,96,145,163,36,240,112,147,17,199,0,246,252,182,13,229,31,127,125,172,38,96,215,19,119,4,1,228,2,142,213,30,110,19,192,54,151,208,172,36,122,134,37,115,166,151,213,75,250,3,56,4,140,14,223,94,54,95,115,110,121,160,235,132,218,238,59,251,184,178,114,210,251,194,238,232,238,44,55,92,116,98,153,63,125,114,144,16,57,107,102,95,173,214,14,193,55,1,55,129,171,12,60,159,75,159,53,63,43,193,76,140,215,94,216,185,61,8,216,177,105,85,0,150,136,173,107,6,67,25,65,128,214,38,2,176,153,0,27,167,71,151,47,44,195,115,63,95,214,15,246,151,157,15,223,25,207,228,57,91,174,191,188,140,244,116,134,13,247,156,24,36,0,254,206,206,119,197,182,165,132,73,101,126,207,212,122,92,2,17,96,233,176,180,1,246,67,31,60,118,159,4,100,18,200,184,74,62,103,126,123,125,8,64,1,152,121,96,231,200,138,80,129,251,28,7,156,100,229,196,199,49,206,99,120,122,116,229,130,50,178,176,171,140,222,50,167,38,96,231,234,197,65,192,230,171,78,13,131,32,72,32,12,2,252,199,143,139,112,128,0,74,39,6,1,58,189,38,224,229,98,189,41,127,72,202,164,140,85,127,179,116,241,108,100,255,202,83,0,230,165,227,197,171,125,143,175,91,185,36,64,18,2,144,32,17,146,199,51,184,30,2,54,44,238,138,45,247,242,156,167,239,90,92,182,46,237,13,98,56,183,118,65,111,25,154,211,74,132,216,172,207,182,192,83,33,0,143,98,73,210,144,192,251,239,69,0,0,179,18,198,10,141,15,30,123,76,77,128,42,224,57,230,3,188,47,120,100,78,169,195,131,188,48,128,50,9,28,135,4,174,109,130,103,159,45,215,113,205,232,80,79,89,191,164,55,8,240,62,194,34,192,15,76,10,91,179,184,55,72,64,238,84,1,75,227,162,25,23,214,77,20,4,176,95,135,0,32,78,251,196,71,163,188,101,15,55,129,123,174,73,0,241,196,86,118,105,92,194,107,207,252,183,255,71,178,1,230,153,22,184,93,91,214,212,91,0,10,216,243,40,130,115,209,67,84,64,169,24,209,62,87,4,0,154,142,146,100,136,228,127,53,239,195,101,253,181,39,181,72,168,84,64,85,32,89,2,222,198,8,156,77,2,40,245,123,40,32,131,135,12,171,2,228,52,73,145,0,88,84,5,48,205,131,41,85,196,175,4,40,87,128,237,222,254,72,36,197,151,158,219,26,166,204,37,196,99,252,141,217,60,1,90,224,63,186,241,235,101,209,236,169,97,119,244,79,46,195,87,30,31,246,219,254,227,131,0,84,240,179,249,125,161,2,72,128,0,193,59,241,66,37,168,9,192,131,130,6,44,39,52,51,62,64,51,57,218,180,73,157,165,119,218,228,248,33,74,205,146,217,211,34,6,137,107,188,142,119,105,126,216,190,180,245,142,0,159,9,192,4,139,229,227,146,163,220,169,255,75,23,204,173,187,61,140,198,7,18,86,246,159,88,54,94,253,158,80,3,33,193,177,159,246,125,46,206,155,252,242,72,210,102,175,163,217,0,113,80,89,231,146,193,113,175,9,146,42,224,36,152,86,146,57,185,220,124,233,25,101,233,37,31,137,12,76,54,70,170,36,168,103,87,46,140,206,239,159,127,250,74,139,132,63,87,32,119,108,172,173,14,129,145,235,163,58,0,156,100,136,177,143,138,80,79,204,31,84,146,7,136,239,195,150,38,7,79,75,130,106,192,30,184,106,114,25,236,63,45,194,1,171,91,228,246,52,93,228,128,60,216,193,147,88,102,216,248,182,236,113,19,215,0,26,240,11,190,112,76,0,255,233,151,142,46,247,247,30,89,214,93,58,161,108,187,238,232,242,183,121,211,163,68,97,128,199,94,90,187,48,84,64,24,236,254,251,112,13,30,130,158,95,117,118,217,189,126,126,139,152,164,2,154,29,194,128,28,240,195,121,125,161,0,228,139,9,40,146,92,21,14,203,102,118,6,9,228,3,194,1,53,64,2,138,68,153,57,39,212,85,192,97,46,64,233,153,121,16,172,241,48,36,29,217,180,77,132,140,99,116,87,144,176,240,162,163,106,240,35,179,222,94,54,47,122,91,121,114,201,81,1,10,143,2,244,165,39,111,46,47,254,241,236,176,221,219,174,13,18,52,194,195,241,65,144,36,65,149,161,22,155,29,98,159,216,133,0,165,236,252,128,18,7,164,57,129,132,8,17,191,95,50,37,136,224,56,120,50,1,161,0,50,98,196,69,79,43,169,220,62,239,204,184,65,227,111,142,227,117,110,150,36,8,64,1,203,46,63,186,172,152,53,161,38,0,219,50,119,66,25,29,156,90,118,61,190,44,8,216,253,215,91,106,2,2,228,166,155,91,38,17,213,62,222,135,132,127,63,248,221,242,226,230,161,214,241,138,0,72,36,9,174,190,229,186,72,174,121,74,221,120,54,201,45,190,230,171,17,243,84,6,60,63,186,104,74,40,97,199,226,79,71,94,192,97,224,180,25,10,5,56,161,128,151,241,252,242,158,211,131,65,164,44,9,223,154,121,70,16,16,113,87,109,249,27,207,223,122,217,59,130,0,100,183,102,238,145,145,132,176,117,221,71,7,251,12,120,136,109,64,35,113,12,128,0,198,235,16,36,9,16,16,33,64,152,84,70,232,112,156,68,74,221,151,0,128,163,2,51,185,3,28,200,224,248,208,245,115,98,100,8,9,228,162,209,217,147,203,150,175,119,133,173,248,242,196,32,128,107,32,97,15,5,224,85,36,4,120,129,140,44,56,34,128,17,14,253,95,60,169,78,122,196,61,4,232,125,108,120,206,225,113,45,198,15,65,202,3,11,186,90,227,254,165,167,183,98,188,146,63,222,141,140,95,121,86,35,68,84,1,224,159,93,53,16,201,19,18,162,253,93,52,119,76,5,0,62,151,56,67,36,147,176,177,235,51,97,140,18,169,10,28,231,252,30,10,136,25,150,138,0,60,139,10,32,1,41,63,252,237,119,132,2,0,8,96,73,248,246,121,135,151,21,151,29,222,2,95,109,1,143,145,11,184,62,50,111,69,38,13,9,36,132,39,170,144,120,106,120,110,203,243,54,65,13,18,66,250,21,17,0,15,18,42,163,146,100,240,206,58,233,56,60,137,130,217,183,98,69,62,168,178,62,96,71,230,246,134,73,0,199,185,151,107,106,2,184,217,172,79,70,215,163,38,53,136,0,40,146,199,50,104,77,162,72,54,128,231,7,86,124,255,202,40,93,196,31,67,86,73,112,76,80,43,161,10,5,192,107,144,4,248,104,127,171,30,64,2,152,248,144,0,39,73,53,192,91,165,48,194,21,60,203,250,46,10,35,55,176,229,189,34,124,42,210,130,0,38,31,172,2,113,83,229,101,72,64,202,235,187,15,171,19,27,38,88,247,33,135,125,174,69,53,132,138,224,145,34,4,48,243,75,103,54,50,48,61,212,192,118,219,80,127,148,54,192,59,75,100,179,4,1,74,159,97,239,99,109,240,24,243,1,180,217,230,2,85,96,53,32,63,9,158,173,205,154,221,42,36,217,16,217,251,180,146,224,204,86,115,1,99,72,228,174,234,69,35,7,180,129,3,84,163,196,177,221,120,99,69,208,141,39,135,173,153,127,106,84,11,192,91,166,234,151,174,20,64,83,196,0,5,2,216,50,156,37,179,51,49,130,34,216,87,21,36,61,100,207,53,220,203,51,98,54,185,189,138,132,195,0,142,18,12,139,8,131,54,6,39,106,85,67,179,123,229,60,215,115,62,8,112,33,2,21,240,96,30,10,1,120,148,114,182,179,247,157,209,216,96,36,197,39,127,112,66,216,227,63,249,88,36,56,123,111,154,20,61,239,128,3,5,96,156,7,204,207,151,93,22,100,48,124,101,12,79,217,227,25,40,2,143,199,144,185,242,62,132,64,12,234,161,165,102,100,41,9,122,31,34,220,135,4,60,234,172,176,83,246,185,101,199,28,196,217,212,5,1,140,219,29,31,235,57,6,18,17,183,85,242,218,222,59,177,108,189,226,132,216,82,87,105,44,178,65,22,32,1,158,7,28,12,88,120,22,231,216,103,203,115,81,0,164,81,155,177,63,15,156,24,185,129,145,30,94,15,50,170,242,25,115,134,132,79,213,255,227,121,191,40,225,153,56,13,2,84,131,30,109,182,235,142,112,155,83,125,42,34,38,68,120,168,179,186,202,138,50,65,230,124,108,198,199,163,126,210,85,153,200,216,34,229,135,190,247,133,240,40,215,2,78,175,187,117,118,24,240,144,131,66,80,1,247,82,22,119,222,48,49,108,91,207,132,32,214,105,114,84,1,33,168,132,248,71,1,122,159,247,115,122,204,5,19,242,66,94,141,86,5,230,1,13,50,80,0,6,120,200,56,226,221,239,44,29,62,88,139,184,173,126,24,169,146,176,48,246,73,72,120,132,150,20,73,3,94,207,155,144,154,137,201,125,21,16,201,176,34,16,175,3,126,199,87,222,95,158,188,160,165,48,189,206,164,135,224,35,23,48,233,89,133,128,10,96,235,36,41,251,152,61,129,102,141,55,1,170,12,19,163,185,33,8,112,10,218,184,138,21,219,118,226,2,60,146,229,111,198,226,16,67,41,18,56,94,205,235,116,185,61,205,211,79,153,0,228,15,1,228,20,8,8,18,6,186,91,192,135,91,13,16,38,120,23,86,92,62,107,26,231,121,103,126,43,19,96,8,56,164,111,230,134,154,0,7,67,134,0,146,6,48,192,9,3,9,200,165,40,123,185,105,102,228,188,42,67,28,67,0,132,66,0,128,81,0,158,103,27,201,180,202,1,92,231,106,113,76,130,86,150,189,206,36,139,150,23,83,57,207,187,11,30,139,105,186,246,223,57,36,156,231,168,9,112,97,145,60,96,217,2,52,109,100,116,82,85,27,42,120,19,79,238,201,243,52,83,72,177,61,214,246,184,11,25,198,63,249,132,152,199,168,50,33,255,42,39,152,83,32,10,2,240,184,11,170,146,144,151,206,244,126,206,9,185,42,228,118,153,178,8,70,71,180,16,96,30,232,112,73,219,53,120,251,232,0,95,121,140,118,86,233,231,204,171,249,67,154,237,104,86,5,207,52,254,135,123,78,137,249,123,128,19,6,86,25,8,160,74,100,2,178,167,93,101,242,27,195,177,12,50,124,71,115,90,51,55,248,126,132,66,77,128,203,218,52,65,120,21,5,64,0,224,121,121,65,250,80,189,111,220,231,228,231,202,75,196,100,123,34,210,103,50,68,165,191,32,241,61,125,193,17,17,255,52,90,144,64,55,73,73,37,201,146,11,232,20,141,123,215,1,93,39,80,246,126,89,226,7,151,126,76,33,1,40,130,223,199,108,142,236,23,200,15,65,128,139,26,142,164,48,21,128,197,58,252,140,11,235,245,120,219,78,65,218,90,42,183,156,3,60,15,177,76,153,65,0,227,115,8,160,205,166,201,130,4,200,160,228,198,244,118,149,11,98,5,185,138,127,192,10,52,203,30,176,126,99,212,244,184,192,221,247,131,43,103,181,156,223,36,4,234,36,40,48,67,192,12,207,139,59,121,224,114,115,78,48,174,7,232,121,99,45,203,142,115,180,200,49,207,208,150,255,83,83,142,44,59,166,29,87,118,156,127,120,203,42,18,172,253,24,13,17,99,4,151,210,76,130,182,195,18,0,64,59,79,151,204,179,73,2,231,37,64,240,54,70,29,249,243,19,147,7,51,43,25,184,179,46,130,207,19,166,2,117,146,146,243,198,25,251,65,64,91,1,76,152,110,232,254,112,217,116,250,145,255,37,161,2,79,37,200,4,208,13,58,62,128,0,7,65,88,211,211,122,56,119,135,92,159,195,213,143,39,172,0,246,1,53,1,46,106,250,48,165,91,131,172,188,156,7,28,62,76,2,204,172,152,75,228,30,15,2,123,166,134,2,88,180,100,182,136,16,0,252,243,83,39,181,122,129,170,37,14,207,87,189,0,224,49,134,195,140,11,232,7,126,249,157,111,212,139,25,130,205,224,61,54,22,73,88,46,133,42,97,143,42,32,144,236,233,12,58,123,222,7,8,216,7,55,67,192,31,101,136,202,100,36,243,5,204,27,226,249,231,190,124,102,24,4,176,101,6,153,46,144,15,38,106,2,170,102,8,21,208,17,18,142,132,166,96,173,62,254,157,9,200,91,148,192,117,217,105,182,198,180,196,111,125,203,97,173,175,36,28,36,8,40,39,177,76,138,32,253,150,160,217,105,57,189,174,10,98,126,161,187,53,195,12,1,204,51,62,241,169,15,212,4,252,109,246,244,106,84,216,31,13,23,99,0,70,128,49,22,168,114,128,106,136,70,172,34,1,51,169,229,73,16,67,206,119,117,214,8,133,56,217,51,86,253,127,253,235,94,87,246,250,68,230,205,111,122,99,44,143,193,144,15,53,20,124,72,94,38,207,31,76,53,87,145,66,33,147,58,99,10,157,57,66,38,73,105,129,145,188,224,241,110,54,8,136,209,32,243,5,75,91,235,128,236,71,27,94,121,211,166,72,18,244,168,14,200,121,204,248,207,99,127,188,254,166,55,190,97,239,79,100,154,134,52,184,88,47,59,144,112,223,21,164,12,92,249,103,2,98,130,165,170,0,177,166,63,123,114,0,119,24,140,236,237,247,177,216,95,185,160,14,3,230,11,172,8,206,12,153,253,173,239,134,153,43,89,126,171,144,207,217,240,232,241,253,250,76,142,155,32,195,16,129,128,60,229,148,215,15,141,49,195,2,111,224,53,94,156,142,146,97,53,36,48,199,0,56,142,59,216,193,216,143,47,71,170,184,111,17,208,34,33,66,164,106,199,105,202,108,189,115,206,202,249,198,240,203,89,254,229,128,239,215,135,146,18,145,63,140,16,172,18,52,55,248,169,172,95,122,50,14,192,131,128,97,16,132,26,136,235,88,237,109,180,178,72,156,193,16,231,2,120,123,56,142,185,182,231,10,116,94,232,180,211,203,19,31,251,2,190,95,4,228,28,1,17,228,9,195,65,5,152,11,28,86,251,225,164,42,80,202,198,179,146,153,149,0,0,1,29,73,68,65,84,52,96,253,206,79,227,59,2,38,64,76,122,49,34,29,104,77,111,187,162,35,96,19,181,196,55,147,219,43,181,253,34,32,43,34,127,35,224,132,3,47,226,23,156,26,253,57,74,0,152,107,252,200,61,131,183,197,181,175,135,52,202,30,134,244,51,1,77,224,185,164,189,26,44,175,138,128,38,17,198,189,73,200,6,36,119,112,0,126,228,238,31,215,150,91,218,252,31,100,92,103,185,115,24,158,135,221,118,157,14,102,94,45,240,131,66,128,102,162,196,27,14,140,0,161,247,49,64,231,17,156,195,215,230,63,79,248,165,184,51,212,14,210,44,197,120,125,172,114,54,174,4,100,34,136,197,172,4,9,112,82,35,19,224,54,95,99,23,167,231,115,57,35,247,28,168,199,15,41,1,153,8,255,115,196,207,231,253,246,95,79,231,97,109,6,159,39,92,32,210,249,252,131,13,252,144,18,208,36,162,169,8,149,208,28,188,228,30,95,169,239,111,86,255,159,34,96,44,69,144,35,252,106,59,203,189,94,223,107,127,176,117,168,60,62,46,4,100,34,0,103,104,232,241,252,233,234,107,5,124,92,8,200,68,80,198,28,166,142,7,240,113,37,64,115,121,106,60,223,225,63,196,107,22,231,51,35,228,200,0,0,0,0,73,69,78,68,174,66,96,130].to_vec(),
        }
    }
    pub unsafe fn image(&self) -> &'static Option<web_sys::ImageBitmap> {
        match self {
            TileImg::Iceberg => {
                static mut BITMAP: Option<web_sys::ImageBitmap> = None;
                if BITMAP.is_none() {
                    let raw_data = self.data();
                    let binary = js_sys::Uint8Array::new(&raw_data.iter().map(|x| JsValue::from_f64(*x as f64)).collect::<js_sys::Array>());

                    let altbuf = binary.to_vec();

                    // Convert the png encoded bytes to an rgba pixel buffer (given the PNG is actually in
                    // 8byte RGBA format).
                    let image = image::load_from_memory_with_format(&altbuf, image::ImageFormat::Png).unwrap();
                    // if self.active {
                    //     image = image.huerotate(180);
                    // }
                    let rgba_image = image.to_rgba8();

                    let clamped_buf: Clamped<&[u8]> = Clamped(&rgba_image.as_raw());
                    let image_data_temp = ImageData::new_with_u8_clamped_array_and_sh(clamped_buf, image.width(), image.height()).unwrap();

                    // context.fill_text
                    // context.put_image_data(&image_data_temp, self.pos.x as f64, self.pos.y as f64);
                    let window = web_sys::window().unwrap();
                    let closure = Closure::wrap(Box::new(move |bitm: wasm_bindgen::JsValue| {
                        BITMAP = Some(web_sys::ImageBitmap::from(bitm));
                    }) as Box<dyn FnMut(_)>);
                    let _promise = window.create_image_bitmap_with_image_data(&image_data_temp).unwrap().then(&closure);
                    closure.forget();
                }

                &BITMAP
            },
            TileImg::Volcano => {
                static mut BITMAP: Option<web_sys::ImageBitmap> = None;
                if BITMAP.is_none() {
                    let raw_data = self.data();
                    let binary = js_sys::Uint8Array::new(&raw_data.iter().map(|x| JsValue::from_f64(*x as f64)).collect::<js_sys::Array>());

                    let altbuf = binary.to_vec();

                    // Convert the png encoded bytes to an rgba pixel buffer (given the PNG is actually in
                    // 8byte RGBA format).
                    let image = image::load_from_memory_with_format(&altbuf, image::ImageFormat::Png).unwrap();
                    // if self.active {
                    //     image = image.huerotate(180);
                    // }
                    let rgba_image = image.to_rgba8();

                    let clamped_buf: Clamped<&[u8]> = Clamped(&rgba_image.as_raw());
                    let image_data_temp = ImageData::new_with_u8_clamped_array_and_sh(clamped_buf, image.width(), image.height()).unwrap();

                    // context.fill_text
                    // context.put_image_data(&image_data_temp, self.pos.x as f64, self.pos.y as f64);
                    let window = web_sys::window().unwrap();
                    let closure = Closure::wrap(Box::new(move |bitm: wasm_bindgen::JsValue| {
                        BITMAP = Some(web_sys::ImageBitmap::from(bitm));
                    }) as Box<dyn FnMut(_)>);
                    let _promise = window.create_image_bitmap_with_image_data(&image_data_temp).unwrap().then(&closure);
                    closure.forget();
                }

                &BITMAP
            }
        }
    }
}

#[derive(Clone, Hash, PartialEq, Eq, Debug)]
pub struct Tile {
    img: TileImg,
    pos: Pos,
}
impl Default for Tile {
    fn default() -> Self {
        Tile {
            img: TileImg::default(),
            pos: Pos::default(),
        }
    }
}

impl Clickable for Tile {
    fn was_clicked(&self, world: Option<&World>, x: f64, y: f64) -> bool {
        let camera = world.unwrap().camera;
        match camera {
            Offset::ScreenSpace((x_offset, y_offset)) => {
                let pos = (self.pos.x * 32, self.pos.y * 32);
                let x = x - x_offset;
                let y = y - y_offset;
                let x_min = pos.0 as f64 - 32.0;
                let x_max = pos.0 as f64 + 32.0;
                let y_min = pos.1 as f64 - 32.0;
                let y_max = pos.1 as f64 + 32.0;
                // console_log!("{:?} {} {}", pos, x, y);
                x_min <= x && x <= x_max && y_min <= y && y <= y_max
            }
            Offset::WorldSpace(_) => false
        }
    }
    fn clicked_mut(&mut self, _world: Option<&World>, info: &mut Option<DisplayInfo>, _x: f64, _y: f64) {
        *info = Some(DisplayInfo {name: format!("Clicked tile at {:?}", self.pos), attrs: vec![]});
        console_log!("clicked_mut {:?}", self.pos);
    }
}
impl Renderable for Tile {
    fn render(&self, context: &CanvasRenderingContext2d, offset: Offset) {
        unsafe {
            let bitmap = self.img.image();

            if let Some(bitmap) = bitmap {
                match offset {
                    Offset::WorldSpace(pos) => {
                        context.draw_image_with_image_bitmap(&bitmap, pos.x as f64 * 32.0 + self.pos.x as f64 * 32.0, pos.y as f64 * 48.0 + self.pos.y as f64 * 48.0).unwrap();
                    }
                    Offset::ScreenSpace(pos) => {
                        context.draw_image_with_image_bitmap(&bitmap, pos.0 as f64 + self.pos.x as f64 * 32.0, pos.1 as f64 + self.pos.y as f64 * 48.0).unwrap();
                    }
                }
                // {
                //     let s = ((self.pos.x as f64 * 32.0) + offset.x as f64, (self.pos.y as f64 * 48.0) + offset.y as f64);
                //     let _ = context.draw_image_with_image_bitmap(&bitmap, s.0, s.1);
                // }
            }
        }
    }
}
impl Tile {
    pub fn new_with_xy(img: TileImg, x: i64, y: i64) -> Tile {
        Tile {
            img,
            pos: Pos::new(x, y),
        }
    }
    pub fn new_with_pos(img: TileImg, pos: Pos) -> Tile {
        Tile {
            img,
            pos,
        }
    }
    pub fn new_with_offset(img: TileImg, offset: Offset) -> Tile {
        Tile {
            img,
            pos: Pos::from(offset),
        }
    }
}
